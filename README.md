# Architecture_serveur1
4. Configure Server Blocks  If you wish to host multiple sites/domains on Nginx, you should now set up your directory structures and Server Blocks.  For the purposes of this guide, we will make a Server Block for mytest1.com and another for mytest2.com. You can substitute these with your own registered domains, or if you don’t have any domains yet, you can still follow this guide and add mytest1.com and mytest2.com to your hosts file to trick your OS into resolving these domains in the browser. We’ll explain how to do this at the end of the guide. 5.1. Create Directories and Set Permissions  Let’s create two new directories in the /var/www/ directory for our two domains.  sudo mkdir -p /var/www/mytest1.com/public_html  sudo mkdir -p /var/www/mytest2.com/public_html  If we want our regular non-root user to be able to modify files in these directories, we must change the ownership.  sudo chown -R $(whoami):$(whoami) /var/www/mytest1.com/public_html  sudo chown -R $(whoami):$(whoami) /var/www/mytest2.com/public_html  The $(whoami) variable will take the value of the user you are currently logged in as.  We must also make sure the permissions for the general web directory /var/www and its contents are set to 755 so that pages can be served correctly.  sudo chmod -R 755 /var/www  5.2. Create Test Web Pages  We’ll now create a simple index.html web page for each domain using the echo command.  Don’t forget to replace mytest1.com with your own domain here if you have one.  sudo echo "Welcome to mytest1.com!" > /var/www/mytest1.com/public_html/index.html  Now do the same for mytest2.com.  sudo echo "Welcome to mytest2.com!" > /var/www/mytest2.com/public_html/index.html  5.3 Create the First Server Block  Nginx contains a default server block in /etc/nginx/sites-available/default which we can use as a template for our own server blocks.  Copy this file to a new file named after your domain. In this example, mytest1.com  sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/mytest1.com  Now edit the file you just copied:  sudo nano /etc/nginx/sites-available/mytest1.com  Press CTRL + W and search for default_server;. /etc/nginx/sites-available/mytest1.com          listen 80 default_server;         listen [::]:80 default_server;  Only one server block can have the default_server specification. This tells Nginx which block to revert to if the server_name requested does not match any of the available server blocks.  Remove default_server from the listen directive so it looks likes this. /etc/nginx/sites-available/mytest1.com          listen 80;         listen [::]:80;  Press CTRL + W and search for root /var/www/html;.  Change this root to the path of the directory you created earlier. In our example, /var/www/mytest1.com/public_html /etc/nginx/sites-available/mytest1.com      root /var/www/mytest1.com/public_html;  Press CTRL + W and search for server_name _;.  Change this to your domain name. In our example, mytest1.com. We will also add www. here as well. /etc/nginx/sites-available/mytest1.com      server_name mytest1.com www.mytest1.com;  Save and exit (press CTRL + X, press Y and then press ENTER)  Ensure the Nginx config file syntax is valid before continuing to the next step.  sudo nginx -t  Output:  nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful  5.4 Create the Second Server Block  We will now create a server block for our other domain name, in this example, mytest2.com.  Firstly, let’s copy the default server block in /etc/nginx/sites-available/default. Copy this file to a new file named after your domain. In this example, mytest2.com  sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/mytest2.com  Now edit the file you just copied.  sudo nano /etc/nginx/sites-available/mytest2.com  Press CTRL + W and search for default_server;. /etc/nginx/sites-available/mytest2.com          listen 80 default_server;         listen [::]:80 default_server;  Only one server block can have the default_server specification. This tells Nginx which block to revert to if the server_name requested does not match any of the available server blocks.  Remove default_server from the listen directive so it looks likes this. /etc/nginx/sites-available/mytest2.com          listen 80;         listen [::]:80;  Press CTRL + W and search for root /var/www/html;.  Change this root to the path of the directory you created earlier. In our example, /var/www/mytest2.com/public_html /etc/nginx/sites-available/mytest2.com      root /var/www/mytest2.com/public_html;  Press CTRL + W and search for server_name _;.  Change this to your domain name. In our example, mytest2.com. We will also add www. here as well. /etc/nginx/sites-available/mytest2.com      server_name mytest2.com www.mytest2.com;  Save and exit (press CTRL + X, press Y and then press ENTER)  Ensure the Nginx config file syntax is valid before continuing to the next step.  sudo nginx -t  Output:  nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful  6. Create Symbolic Links  We will now create symbolic links from the sites-available directory to the sites-enabled directory, which Nginx reads during startup. Be sure to replace mytest1.com and mytest2.com with your own domains if you have them.  sudo ln -s /etc/nginx/sites-available/mytest1.com /etc/nginx/sites-enabled/  sudo ln -s /etc/nginx/sites-available/mytest2.com /etc/nginx/sites-enabled/  We can also remove the symbolic link for the default server block.  sudo rm /etc/nginx/sites-enabled/default  Now restart Nginx.  sudo service nginx restart
